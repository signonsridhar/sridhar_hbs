!function(a){var b=function(a,b){var f,c=a.length,d=0,e=[];for(d;c>d;d++){if(f=b[d],"string"!=typeof f)return null;if("**"==a[d])return b.join(".");if("*"==a[d])e.push(f);else{if(f!==a[d])return null;e.push(f)}}return e.join(".")},c=function(c,d,e,f,g){var j,k,l,m,n,h=d.split("."),i=(this._observe_delegates||[]).slice(0);c.attr=d,c.lastAttr=h[h.length-1];for(var o=0;j=i[o++];)if(!(c.batchNum&&j.batchNum===c.batchNum||j.undelegated)){m=void 0,n=!0;for(var p=0;p<j.attrs.length;p++)k=j.attrs[p],(l=b(k.parts,h))&&(m=l),k.value&&n?n=k.value===""+this.attr(k.attr):n&&j.attrs.length>1&&(n=void 0!==this.attr(k.attr));if(m&&n){var q=d.replace(m+".","");c.batchNum&&(j.batchNum=c.batchNum),"change"===j.event?(arguments[1]=q,c.curAttr=m,j.callback.apply(this.attr(m),a.makeArray(arguments))):j.event===e?j.callback.apply(this.attr(m),[c,f,g,q]):"set"===j.event&&"add"==e&&j.callback.apply(this.attr(m),[c,f,g,q])}}};return a.extend(a.Observe.prototype,{delegate:function(b,d,e){b=a.trim(b);for(var i,f=this._observe_delegates||(this._observe_delegates=[]),g=[],h=/([^\s=,]+)(?:=("[^",]*"|'[^',]*'|[^\s"',]*))?(,?)\s*/g;i=h.exec(b);)i[2]&&a.inArray(i[2].substr(0,1),['"',"'"])>=0&&(i[2]=i[2].substr(1,-1)),g.push({attr:i[1],parts:i[1].split("."),value:i[2],or:","===i[3]});return f.push({selector:b,attrs:g,callback:e,event:d}),1===f.length&&this.bind("change",c),this},undelegate:function(b,d,e){b=b&&a.trim(b);var h,f=0,g=this._observe_delegates||[];if(b)for(;f<g.length;)h=g[f],h.callback===e||!e&&h.selector===b?(h.undelegated=!0,g.splice(f,1)):f++;else g=[];return g.length||this.unbind("change",c),this}}),a.Observe.prototype.delegate.matches=b,a.Observe}(can);